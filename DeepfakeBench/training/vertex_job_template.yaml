# vertex_job_template.yaml
# The root of this file IS the content of the 'jobSpec' object.
# All keys are in the required camelCase format.

# This is a required field for Vertex AI to store job outputs.
# IMPORTANT: Make sure this bucket exists and the service account has access.
baseOutputDirectory:
  outputUriPrefix: gs://training-job-outputs/vertex-output/{{JOB_NAME}}

# This is where we define job behavior, like timeouts.
scheduling:
  timeout: 86400s           # 24h hard cut-off
  restartJobOnWorkerRestart: true # This was 'restart_job_on_worker_restart'

# The spec for our machine and container.
workerPoolSpecs:
  - machineSpec:
      # The machine type compatible with A100s
      machineType: a2-highgpu-1g
      acceleratorType: "{{GPU_TYPE}}"
      acceleratorCount: {{GPU_COUNT}}
    replicaCount: 1
    # This was 'disk_spec' in your original file.
    diskSpec:
      bootDiskType: pd-ssd
      bootDiskSizeGb: 200
    containerSpec:
      imageUri: "{{IMAGE_URI}}"
      # The command and args for your container.
      command: ["/bin/bash", "/workspace/entrypoint.sh"]
      args: []
      # This is the section for your environment variables.
      env:
      - name: WANDB_API_KEY
        value: "{{WANDB_API_KEY}}"
      - name: WANDB_PROJECT
        value: "{{WANDB_PROJECT}}"
      - name: WANDB_ENTITY
        value: "{{WANDB_ENTITY}}"
      - name: JOB_MODE
        value: "{{JOB_MODE}}"

# The dedicated service account for running the job.
serviceAccount: "{{SERVICE_ACCOUNT}}"